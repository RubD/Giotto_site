<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contribute • Giotto</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Contribute">
<meta property="og:description" content="Giotto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-109153024-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109153024-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Giotto</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Start
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html#description">Description</a>
    </li>
    <li>
      <a href="../articles/getting_started.html#workflow-diagram">Workflow</a>
    </li>
    <li>
      <a href="../articles/getting_started.html#howtos">HOWTOs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Datasets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mini_seqfish.html">mini seqFISH</a>
    </li>
    <li>
      <a href="../articles/mini_visium.html">mini visium (spots)</a>
    </li>
    <li>
      <a href="../articles/mini_starmap.html">mini 3D STARmap</a>
    </li>
    <li>
      <a href="../articles/mouse_seqFISH_cortex_200914.html">mouse seqFISH cortex</a>
    </li>
    <li>
      <a href="../articles/mouse_merFISH_preoptic_region_200909.html">mouse hypoth. preopt. region</a>
    </li>
    <li>
      <a href="../articles/mouse_starmap_cortex_200917.html">mouse STARmap cortex</a>
    </li>
    <li>
      <a href="../articles/human_cycif_PDAC_200916.html">human CyCIF PDAC</a>
    </li>
    <li>
      <a href="../articles/mouse_visium_brain_201226.html">mouse Visium brain</a>
    </li>
    <li>
      <a href="../articles/mouse_visium_kidney_200916.html">mouse Visium kidney</a>
    </li>
    <li>
      <a href="../articles/mouse_CODEX_spleen_200921.html">mouse CODEX spleen</a>
    </li>
    <li>
      <a href="../articles/mouse_osmFISH_SScortex_200915.html">mouse osmFISH SScortex</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/contribute.html">Contribute</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    FAQ
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/faqs.html">Frequently Asked Questions</a>
    </li>
    <li>
      <a href="../articles/github_issues.html">GitHub Issues Guidelines</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Try Giotto
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/docker.html">Docker</a>
    </li>
    <li>
      <a href="../articles/binder.html">Binder</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/RubD/Giotto">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RubD/Giotto/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="contribute_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Contribute</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RubD/Giotto/blob/master/vignettes/contribute.Rmd"><code>vignettes/contribute.Rmd</code></a></small>
      <div class="hidden name"><code>contribute.Rmd</code></div>

    </div>

    
    
<div id="how-to-contribute" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-contribute" class="anchor"></a>How to contribute</h2>
<p>We welcome contributions or suggestions from other developers and here we provide a number of rules, suggestions and tips to help you contribute to Giotto in a sustainable manner. Please contact us if you have questions or would like to discuss an addition or major modifications to the Giotto main code.</p>
<p><span class="math inline">\(~\)</span></p>
<div id="coding-style" class="section level3">
<h3 class="hasAnchor">
<a href="#coding-style" class="anchor"></a>Coding Style</h3>
<p>Following a particular programming style will help programmers read and understand source code conforming to the style, and help to avoid introducing errors. Here we present a small list of guidelines on what is considered a good practice when writing R codes in Giotto package. Most of them are adapted from <a href="https://bioconductor.org/developers/how-to/coding-style/">Bioconductor - coding style</a> or <a href="https://google.github.io/styleguide/Rguide.xml">Google’s R Style Guide</a>. These guidelines are preferences and strongly encouraged!</p>
<ul>
<li>
<strong>Indentation</strong>
<ul>
<li>Use 4 spaces for indenting. No tabs.</li>
<li>Prefereably no lines longer than 80 characters. This includes function documentations, examples, and vignette code chunks.</li>
</ul>
</li>
<li>
<strong>Function names</strong>
<ul>
<li>Use camelCase.</li>
<li>Do not use “.” (in the S3 class system, some(x) where x is class A will dispatch to some.A).</li>
<li>Use underscores for non-exported functions, like ‘non_exported_function’.</li>
</ul>
</li>
<li>
<strong>Use of space</strong>
<ul>
<li>Do not place a space before a comma, but always place one after a comma. This: a, b, c.<br>
</li>
<li>Always use space around “=” when using named arguments to functions. This: somefunc(a = 1, b = 2).</li>
</ul>
</li>
</ul>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="stat-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#stat-functions" class="anchor"></a>Stat functions</h3>
<p>Most Giotto commands can accept several matrix classes (SparseM, Matrix or base). To facilitate this we provide small wrappers that work on any type of matrix class.</p>
<ul>
<li>
<strong>mean_giotto</strong>: analogous to mean()<br>
</li>
<li>
<strong>rowSums_giotto</strong>: analogous to rowSums()<br>
</li>
<li>
<strong>rowMeans_giotto</strong>: analogous to rowMeans()<br>
</li>
<li>
<strong>colSums_giotto</strong>: analogous to colSums()<br>
</li>
<li>
<strong>colMeans_giotto</strong>: analogous to colMeans()<br>
</li>
<li>
<strong>t_giotto</strong>: analogous to t()<br>
</li>
<li>
<strong>cor_sparse</strong>: analogous to cor()</li>
</ul>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="auxiliary-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#auxiliary-functions" class="anchor"></a>Auxiliary functions</h3>
<p>Giotto has a number of auxiliary or convenience functions that might help you to adapt your code or write new code for Giotto. We encourage you to use these small functions to maintain uniformity throughout the code.</p>
<ul>
<li>
<strong>giotto_lapply</strong>: analogous to lapply() and works for both windows and unix systems<br>
</li>
<li>
<strong>all_plots_save_function</strong>: compatible with Giotto instructions and helps to automatically save generated plots<br>
</li>
<li>
<strong>determine_cores</strong>: to determine the number of cores to use if a user does not set this explicitly<br>
</li>
<li>
<strong>get_os</strong>: to identify the operating system<br>
</li>
<li>
<strong>package_check</strong>: to check if a package exists, works for packages on CRAN, Bioconductor and Github.</li>
</ul>
<p>The last function should be used within your contribution code. It has the additional benefit that it will suggest the user how to download the package if it is not available. To keep the size of Giotto within limits we prefer not to add too many new dependencies.</p>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="accessors" class="section level3">
<h3 class="hasAnchor">
<a href="#accessors" class="anchor"></a>Accessors</h3>
<p>Giotto stores information in different slots, which can be accessed through these accessor functions.</p>
<ul>
<li>
<strong>select_expression_values</strong>: To select the expression matrix to use (raw, normalized, scaled or custom)<br>
</li>
<li>
<strong>select_dimReduction</strong>: To select the dimension reduction values to use<br>
</li>
<li>
<strong>select_NearestNetwork</strong>: To select the nearest neighbor network (kNN or sNN) to use<br>
</li>
<li>
<strong>select_spatialNetwork</strong>: To select the spatial network to use<br>
</li>
<li>
<strong>select_spatialGrid</strong>: To select the spatial grid to use</li>
</ul>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="python-code" class="section level3">
<h3 class="hasAnchor">
<a href="#python-code" class="anchor"></a>Python code</h3>
<p>To use Python code we prefer to create a python wrapper/functions around the python code, which can then be sourced by reticulate. As an example we show the basic principles of how we implemented the Leiden clustering algorithm.</p>
<ol style="list-style-type: decimal">
<li>write python wrapper and store as python_leiden.py in <em>/inst/python</em>:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> igraph <span class="im">as</span> ig</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> leidenalg <span class="im">as</span> la</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> python_leiden(df, partition_type, initial_membership<span class="op">=</span><span class="va">None</span>, weights<span class="op">=</span><span class="va">None</span>, n_iterations<span class="op">=</span><span class="dv">2</span>, seed<span class="op">=</span><span class="va">None</span>, resolution_parameter <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create networkx object</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    Gx <span class="op">=</span> nx.from_pandas_edgelist(df <span class="op">=</span> df, source <span class="op">=</span> <span class="st">'from'</span>, target <span class="op">=</span>  <span class="st">'to'</span>, edge_attr <span class="op">=</span> <span class="st">'weight'</span>)  </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get weight attribute</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    myweights <span class="op">=</span> nx.get_edge_attributes(Gx, <span class="st">'weight'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    ....</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(leiden_dfr)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>source python code with reticulate:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">python_leiden_function</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"python"</span>, <span class="st">"python_leiden.py"</span>, package <span class="op">=</span> <span class="st">'Giotto'</span><span class="op">)</span>
<span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/source_python.html">source_python</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">python_leiden_function</span><span class="op">)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>use python code as if R code:<br>
See <strong>doLeidenCLuster</strong> for more detailed information.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="va">pyth_leid_result</span> <span class="op">=</span> <span class="fu">python_leiden</span><span class="op">(</span>df <span class="op">=</span> <span class="va">network_edge_dt</span>,
                                   partition_type <span class="op">=</span> <span class="va">partition_type</span>,
                                   initial_membership <span class="op">=</span> <span class="va">init_membership</span>,
                                   weights <span class="op">=</span> <span class="st">'weight'</span>,
                                   n_iterations <span class="op">=</span> <span class="va">n_iterations</span>,
                                   seed <span class="op">=</span> <span class="va">seed_number</span>,
                                   resolution_parameter <span class="op">=</span> <span class="va">resolution</span><span class="op">)</span></code></pre></div>
<p><span class="math inline">\(~\)</span></p>
</div>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h3>
<p>As an example we show the implementation of SPARK, which is a recent method developed by <a href="https://doi.org/10.1038/s41592-019-0701-7">Sun et al</a> and provide some comments within the code.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spark</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">gobject</span>,
                 <span class="va">percentage</span> <span class="op">=</span> <span class="fl">0.1</span>,
                 <span class="va">min_count</span> <span class="op">=</span> <span class="fl">10</span>,
                 <span class="va">expression_values</span> <span class="op">=</span> <span class="st">'raw'</span>,
                 <span class="va">num_core</span> <span class="op">=</span> <span class="fl">5</span>,
                 <span class="va">covariates</span> <span class="op">=</span> <span class="cn">NULL</span>,
                 <span class="va">return_object</span> <span class="op">=</span> <span class="st">'data.table'</span>,
                 <span class="va">...</span><span class="op">)</span> <span class="op">{</span>


  <span class="co"># data.table variables; this is necessary when setting new variables within a data.table</span>
  <span class="va">genes</span> <span class="op">=</span>  <span class="va">adjusted_pvalue</span> <span class="op">=</span> <span class="va">combined_pvalue</span> <span class="op">=</span> <span class="cn">NULL</span>

  <span class="co"># test if SPARK is installed </span>
  <span class="co"># if false, it will suggest how to install SPARK</span>
  <span class="fu"><a href="../reference/package_check.html">package_check</a></span><span class="op">(</span>pkg_name <span class="op">=</span> <span class="st">'SPARK'</span>,
                repository <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'github'</span><span class="op">)</span>,
                github_repo <span class="op">=</span> <span class="st">'xzhoulab/SPARK'</span><span class="op">)</span>


  <span class="co"># print message with information and encouraging users to cite the authors their work  </span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"using 'SPARK' for spatial gene/pattern detection. If used in published research, please cite:
  Sun, Shiquan, Jiaqiang Zhu, and Xiang Zhou. “Statistical Analysis of Spatial Expression Pattern for Spatially Resolved Transcriptomic Studies.”
          BioRxiv, October 21, 2019, 810903. https://doi.org/10.1101/810903."</span><span class="op">)</span>


  <span class="co"># extract expression values from gobject using one of the accessors</span>
  <span class="va">expr</span> <span class="op">=</span> <span class="fu"><a href="../reference/select_expression_values.html">select_expression_values</a></span><span class="op">(</span>gobject <span class="op">=</span> <span class="va">gobject</span>, values <span class="op">=</span> <span class="va">expression_values</span><span class="op">)</span>

  <span class="co"># extract coordinates from gobject</span>
  <span class="co"># check the different slots of the giotto S4 object</span>
  <span class="va">locs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">gobject</span><span class="op">@</span><span class="va">spatial_locs</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">locs</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span>

  
  <span class="co"># Here we implemented spark according to their github example code: </span>
  
  <span class="co"># create SPARK object for analysis and filter out lowly expressed genes</span>
  <span class="va">sobject</span> <span class="op">=</span> <span class="fu">SPARK</span><span class="fu">::</span><span class="fu">CreateSPARKObject</span><span class="op">(</span>counts <span class="op">=</span> <span class="va">expr</span>,
                                     location <span class="op">=</span> <span class="va">locs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,
                                     percentage <span class="op">=</span> <span class="va">percentage</span>,
                                     min_total_counts <span class="op">=</span> <span class="va">min_count</span><span class="op">)</span>

  <span class="co"># total counts for each cell</span>
  <span class="va">sobject</span><span class="op">@</span><span class="va">lib_size</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sobject</span><span class="op">@</span><span class="va">counts</span>, <span class="fl">2</span>, <span class="va">sum</span><span class="op">)</span>

  <span class="co"># extract covariates to adjust for from the cell metadata </span>
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">covariates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>

    <span class="co"># first filter giotto object based on spark object</span>
    <span class="va">filter_cell_ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sobject</span><span class="op">@</span><span class="va">counts</span><span class="op">)</span>
    <span class="va">filter_gene_ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sobject</span><span class="op">@</span><span class="va">counts</span><span class="op">)</span>
    <span class="va">tempgobject</span> <span class="op">=</span> <span class="fu"><a href="../reference/subsetGiotto.html">subsetGiotto</a></span><span class="op">(</span><span class="va">gobject</span>, cell_ids <span class="op">=</span> <span class="va">filter_cell_ids</span>, gene_ids <span class="op">=</span> <span class="va">filter_gene_ids</span><span class="op">)</span>

    <span class="va">metadata</span> <span class="op">=</span> <span class="fu"><a href="../reference/pDataDT.html">pDataDT</a></span><span class="op">(</span><span class="va">tempgobject</span><span class="op">)</span>

    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">covariates</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="va">covariates</span>, <span class="st">' was not found in the cell metadata of the giotto object, will be set to NULL \n'</span><span class="op">)</span>
      <span class="va">covariates</span> <span class="op">=</span> <span class="cn">NULL</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="va">covariates</span> <span class="op">=</span> <span class="va">metadata</span><span class="op">[[</span><span class="va">covariates</span><span class="op">]</span><span class="op">]</span>
    <span class="op">}</span>
  <span class="op">}</span>

  <span class="co"># Fit statistical model under null hypothesis</span>
  <span class="va">sobject</span> <span class="op">=</span> <span class="fu">SPARK</span><span class="fu">::</span><span class="fu">spark.vc</span><span class="op">(</span><span class="va">sobject</span>,
                            covariates <span class="op">=</span> <span class="va">covariates</span>,
                            lib_size <span class="op">=</span> <span class="va">sobject</span><span class="op">@</span><span class="va">lib_size</span>,
                            num_core <span class="op">=</span> <span class="va">num_core</span>,
                            verbose <span class="op">=</span> <span class="cn">F</span>,
                            <span class="va">...</span><span class="op">)</span>

  <span class="co"># test spatially expressed pattern genes</span>
  <span class="co"># calculating pval</span>
  <span class="va">sobject</span> <span class="op">=</span> <span class="fu">SPARK</span><span class="fu">::</span><span class="fu">spark.test</span><span class="op">(</span><span class="va">sobject</span>,
                              check_positive <span class="op">=</span> <span class="cn">T</span>,
                              verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

  <span class="co"># return results</span>
  <span class="co"># return full output or a simple data.table format with the essental information</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">return_object</span> <span class="op">==</span> <span class="st">'spark'</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sobject</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">return_object</span> <span class="op">==</span> <span class="st">'data.table'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">DT_results</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">sobject</span><span class="op">@</span><span class="va">res_mtest</span><span class="op">)</span>
    <span class="va">gene_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sobject</span><span class="op">@</span><span class="va">counts</span><span class="op">)</span>
    <span class="va">DT_results</span><span class="op">[</span>, <span class="va">genes</span> <span class="op">:=</span> <span class="va">gene_names</span><span class="op">]</span>
    <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">setorder</a></span><span class="op">(</span><span class="va">DT_results</span>, <span class="va">adjusted_pvalue</span>, <span class="va">combined_pvalue</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">DT_results</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.drieslab.com/">Ruben Dries</a>, Qian Zhu, Huipeng Li, Rui Dong, Guo-Cheng Yuan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
