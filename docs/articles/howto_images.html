<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • Giotto</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="Giotto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-109153024-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109153024-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Giotto</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Start
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html#description">Description</a>
    </li>
    <li>
      <a href="../articles/getting_started.html#workflow-diagram">Workflow</a>
    </li>
    <li>
      <a href="../articles/getting_started.html#howtos">HOWTOs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Datasets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mouse_seqFISH_cortex_200319.html">mouse seqFISH cortex</a>
    </li>
    <li>
      <a href="../articles/mouse_merFISH_hypoth_preoptic_region_200326.html">mouse hypoth. preopt. region</a>
    </li>
    <li>
      <a href="../articles/mouse_starmap_cortex.html">mouse STARmap cortex</a>
    </li>
    <li>
      <a href="../articles/human_cycif_PDAC_200322.html">human CyCIF PDAC</a>
    </li>
    <li>
      <a href="../articles/mouse_visium_brain_200325.html">mouse Visium brain</a>
    </li>
    <li>
      <a href="../articles/mouse_visium_kidney_200326.html">mouse Visium kidney</a>
    </li>
    <li>
      <a href="../articles/mouse_CODEX_spleen.html">mouse CODEX spleen</a>
    </li>
    <li>
      <a href="../articles/mouse_osmFISH_SScortex.html">mouse osmFISH SScortex</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faqs.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RubD/Giotto">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RubD/Giotto/blob/master/vignettes/howto_images.Rmd"><code>vignettes/howto_images.Rmd</code></a></small>
      <div class="hidden name"><code>howto_images.Rmd</code></div>

    </div>

    
    
<div id="how-to-work-with-background-images" class="section level1">
<h1 class="hasAnchor">
<a href="#how-to-work-with-background-images" class="anchor"></a>How to work with background images?</h1>
<p>All spatial visualization functions in the Giotto toolbox can be overlaid on a background image. This allows you to visualize your results on top of the original tissue image. We provide multiple ways of adding and modifying figures in Giotto. In short there are 3 things to consider:</p>
<ol style="list-style-type: decimal">
<li>how to add an image to a Giotto object?<br>
</li>
</ol>
<ul>
<li>
<strong>createGiottoVisiumObject</strong> can be used directly for a visium 10X dataset<br>
</li>
<li>
<strong>createGiottoImage</strong> can be used to create a Giotto image object from a magick image object<br>
</li>
<li>
<strong>addGiottoImage</strong> this add a Giotto image to your Giotto object<br>
</li>
<li>
<strong>updateGiottoImage</strong> this helps to adjust the alignment of your image with your results</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>how to modify an image? e.g. change background color<br>
</li>
</ol>
<ul>
<li>
<strong>estimateImageBg</strong> function to estimage the background color of your Giotto or magick image</li>
<li>
<strong>changeImageBg</strong> function to change the background color of your image</li>
<li>
<strong>plotGiottoImage</strong> function to plot an image by itself</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>how to show these images with your spatial plots?</li>
</ol>
<ul>
<li>
<strong>showGiottoImageNames</strong> this tells you which giotto image(s) are part of your giotto object</li>
<li>Each spatial plotting function has the following 3 parameters:
<ul>
<li>show_image = TRUE or FALSE, to show a background image or not<br>
</li>
<li>image_name = name of associated Giotto image to use for the background image (option 1)</li>
<li>gimage = a giotto image object to use (option 2)</li>
</ul>
</li>
<li>
<strong>addGiottoImageToSpatPlot</strong> to test your giotto images you can use this function to them to spatPlot result</li>
</ul>
<p>Here we process the Visium Kidney dataset to illustrate all the different and flexible ways to deal with images:</p>
<div id="create-giotto-giotto-object" class="section level2">
<h2 class="hasAnchor">
<a href="#create-giotto-giotto-object" class="anchor"></a>1. create Giotto Giotto object</h2>
<p>Here we use the wrapper function createGiottoVisiumObject to create a Giotto object for a 10X Visium dataset, which includes a png image.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Giotto</span>)

<span class="no">visium_kidney</span> <span class="kw">=</span> <span class="fu"><a href="../reference/createGiottoVisiumObject.html">createGiottoVisiumObject</a></span>(<span class="kw">visium_dir</span> <span class="kw">=</span> <span class="st">'/path/to/Visium_data/Kidney_data'</span>,
                                         <span class="kw">png_name</span> <span class="kw">=</span> <span class="st">'tissue_lowres_image.png'</span>, <span class="kw">gene_column_index</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
</div>
<div id="align-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#align-plot" class="anchor"></a>2. align plot</h2>
<p>The image plot and the Giotto results are not always perfectly aligned. This step just needs to be done once.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># output from Giotto</span>
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'in_tissue'</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/1_a_spatplot.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># problem: image is not perfectly aligned</span>
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'in_tissue'</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.7</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/1_b_spatplot_image.png" style="width:50.0%"></p>
<p>adjust the x and y minima and maxima to align the image and the giotto output results:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># check name</span>
<span class="fu"><a href="../reference/showGiottoImageNames.html">showGiottoImageNames</a></span>(<span class="no">visium_kidney</span>)
<span class="no">visium_kidney</span> <span class="kw">=</span> <span class="fu"><a href="../reference/updateGiottoImage.html">updateGiottoImage</a></span>(<span class="no">visium_kidney</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image'</span>,
                            <span class="kw">xmax_adj</span> <span class="kw">=</span> <span class="fl">1300</span>, <span class="kw">xmin_adj</span> <span class="kw">=</span> <span class="fl">1200</span>,
                            <span class="kw">ymax_adj</span> <span class="kw">=</span> <span class="fl">1100</span>, <span class="kw">ymin_adj</span> <span class="kw">=</span> <span class="fl">1000</span>)

<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'in_tissue'</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.7</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/1_c_spatplot_image_adjusted.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># plot original image</span>
<span class="fu"><a href="../reference/plotGiottoImage.html">plotGiottoImage</a></span>(<span class="no">visium_kidney</span>, <span class="st">'image'</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/1_d_original_plot.png" style="width:50.0%"></p>
</div>
<div id="change-background-of-a-giotto-or-magick-image" class="section level2">
<h2 class="hasAnchor">
<a href="#change-background-of-a-giotto-or-magick-image" class="anchor"></a>3. change background of a Giotto or magick image</h2>
<p>extract the giotto image from your giotto object and then estimate the background of your image:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">myimage</span> <span class="kw">=</span> <span class="fu"><a href="../reference/getGiottoImage.html">getGiottoImage</a></span>(<span class="no">visium_kidney</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image'</span>) <span class="co"># extract image to modify</span>
<span class="fu"><a href="../reference/estimateImageBg.html">estimateImageBg</a></span>(<span class="kw">mg_object</span> <span class="kw">=</span> <span class="no">myimage</span>, <span class="kw">top_color_range</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">20</span>)  <span class="co"># estimate background (bg) color</span></pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/2_a_background_colors.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## create and test black background</span>
<span class="no">orig_black_png</span> <span class="kw">=</span> <span class="fu"><a href="../reference/changeImageBg.html">changeImageBg</a></span>(<span class="kw">mg_object</span> <span class="kw">=</span> <span class="no">myimage</span>, <span class="kw">bg_color</span> <span class="kw">=</span> <span class="st">'#949594'</span>, <span class="kw">perc_range</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">new_color</span> <span class="kw">=</span> <span class="st">'#000000'</span>, <span class="kw">new_name</span> <span class="kw">=</span> <span class="st">'black_bg'</span>)

<span class="no">mypl</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'in_tissue'</span>, <span class="kw">return_plot</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>)
<span class="no">mypl_image</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addGiottoImageToSpatPlot.html">addGiottoImageToSpatPlot</a></span>(<span class="no">mypl</span>, <span class="no">orig_black_png</span>)
<span class="no">mypl_image</span></pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/2_b_black_background.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">## create and test white background</span>
<span class="no">orig_white_png</span> <span class="kw">=</span> <span class="fu"><a href="../reference/changeImageBg.html">changeImageBg</a></span>(<span class="kw">mg_object</span> <span class="kw">=</span> <span class="no">myimage</span>, <span class="kw">bg_color</span> <span class="kw">=</span> <span class="st">'#949594'</span>, <span class="kw">perc_range</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">new_color</span> <span class="kw">=</span> <span class="st">'#FFFFFF'</span>, <span class="kw">new_name</span> <span class="kw">=</span> <span class="st">'white_bg'</span>)

<span class="no">mypl</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'in_tissue'</span>, <span class="kw">return_plot</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>)
<span class="no">mypl_image</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addGiottoImageToSpatPlot.html">addGiottoImageToSpatPlot</a></span>(<span class="no">mypl</span>, <span class="no">orig_white_png</span>)
<span class="no">mypl_image</span></pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/2_c_white_background.png" style="width:50.0%"></p>
</div>
<div id="add-image-form-scratch" class="section level2">
<h2 class="hasAnchor">
<a href="#add-image-form-scratch" class="anchor"></a>4. Add image form scratch</h2>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co">## use magick library to load (and optionally modify) figure ##</span>
<span class="co"># original image</span>
<span class="no">png_path</span> <span class="kw">=</span> <span class="st">'/Volumes/Ruben_Seagate/Dropbox/Projects/GC_lab/Ruben_Dries/190225_spatial_package/Data/Visium_data/Kidney_data/spatial/tissue_lowres_image.png'</span>
<span class="no">mg_img</span> <span class="kw">=</span> <span class="kw pkg">magick</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span>(<span class="no">png_path</span>)</pre></body></html></div>
<p>create a negated image</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># original image negated</span>
<span class="no">mg_img2</span> <span class="kw">=</span> <span class="kw pkg">magick</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/effects.html">image_negate</a></span>(<span class="no">mg_img</span>)
<span class="no">orig_neg_png</span> <span class="kw">=</span> <span class="fu"><a href="../reference/createGiottoImage.html">createGiottoImage</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">mg_object</span> <span class="kw">=</span> <span class="no">mg_img2</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'image_neg'</span>,
                                 <span class="kw">xmax_adj</span> <span class="kw">=</span> <span class="fl">1300</span>, <span class="kw">xmin_adj</span> <span class="kw">=</span> <span class="fl">1200</span>, <span class="kw">ymax_adj</span> <span class="kw">=</span> <span class="fl">1100</span>, <span class="kw">ymin_adj</span> <span class="kw">=</span> <span class="fl">1000</span>)
<span class="no">mypl_image</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addGiottoImageToSpatPlot.html">addGiottoImageToSpatPlot</a></span>(<span class="no">mypl</span>, <span class="no">orig_neg_png</span>)
<span class="no">mypl_image</span></pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/3_a_external_image_negated.png" style="width:50.0%"></p>
<p>create a charcoal image</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># charcoal image (black/white)</span>
<span class="no">mg_img3</span> <span class="kw">=</span> <span class="kw pkg">magick</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/effects.html">image_charcoal</a></span>(<span class="no">mg_img</span>, <span class="kw">radius</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">mg_img3</span> <span class="kw">=</span> <span class="kw pkg">magick</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_convert</a></span>(<span class="no">mg_img3</span>, <span class="kw">colorspace</span> <span class="kw">=</span> <span class="st">'rgb'</span>)
<span class="no">orig_charc_png</span> <span class="kw">=</span> <span class="fu"><a href="../reference/createGiottoImage.html">createGiottoImage</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">mg_object</span> <span class="kw">=</span> <span class="no">mg_img3</span>, <span class="kw">name</span> <span class="kw">=</span> <span class="st">'image_charc'</span>,
                                   <span class="kw">xmax_adj</span> <span class="kw">=</span> <span class="fl">1300</span>, <span class="kw">xmin_adj</span> <span class="kw">=</span> <span class="fl">1200</span>, <span class="kw">ymax_adj</span> <span class="kw">=</span> <span class="fl">1100</span>, <span class="kw">ymin_adj</span> <span class="kw">=</span> <span class="fl">1000</span>)
<span class="no">mypl_image</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addGiottoImageToSpatPlot.html">addGiottoImageToSpatPlot</a></span>(<span class="no">mypl</span>, <span class="no">orig_charc_png</span>)
<span class="no">mypl_image</span></pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/3_b_external_image_charcoal.png" style="width:50.0%"></p>
<p>add multiple new images to your giotto object</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co">## add images to Giotto object ##</span>
<span class="no">image_list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">orig_white_png</span>, <span class="no">orig_black_png</span>, <span class="no">orig_neg_png</span>, <span class="no">orig_charc_png</span>)
<span class="no">visium_kidney</span> <span class="kw">=</span> <span class="fu"><a href="../reference/addGiottoImage.html">addGiottoImage</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>,
                               <span class="kw">images</span> <span class="kw">=</span> <span class="no">image_list</span>)
<span class="fu"><a href="../reference/showGiottoImageNames.html">showGiottoImageNames</a></span>(<span class="no">visium_kidney</span>) <span class="co"># shows which Giotto images are attached to you Giotto object</span></pre></body></html></div>
</div>
<div id="example-kidney-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#example-kidney-analysis" class="anchor"></a>5. Example Kidney analysis</h2>
<div id="processing" class="section level4">
<h4 class="hasAnchor">
<a href="#processing" class="anchor"></a>5.1 processing</h4>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co">## subset on spots that were covered by tissue</span>
<span class="no">metadata</span> <span class="kw">=</span> <span class="fu"><a href="../reference/pDataDT.html">pDataDT</a></span>(<span class="no">visium_kidney</span>)
<span class="no">in_tissue_barcodes</span> <span class="kw">=</span> <span class="no">metadata</span>[<span class="no">in_tissue</span> <span class="kw">==</span> <span class="fl">1</span>]$<span class="no">cell_ID</span>
<span class="no">visium_kidney</span> <span class="kw">=</span> <span class="fu"><a href="../reference/subsetGiotto.html">subsetGiotto</a></span>(<span class="no">visium_kidney</span>, <span class="kw">cell_ids</span> <span class="kw">=</span> <span class="no">in_tissue_barcodes</span>)

<span class="co">## filter</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/filterGiotto.html">filterGiotto</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>,
                              <span class="kw">expression_threshold</span> <span class="kw">=</span> <span class="fl">1</span>,
                              <span class="kw">gene_det_in_min_cells</span> <span class="kw">=</span> <span class="fl">50</span>,
                              <span class="kw">min_det_genes_per_cell</span> <span class="kw">=</span> <span class="fl">1000</span>,
                              <span class="kw">expression_values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'raw'</span>),
                              <span class="kw">verbose</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="co">## normalize</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/normalizeGiotto.html">normalizeGiotto</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">scalefactor</span> <span class="kw">=</span> <span class="fl">6000</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="co">## add gene &amp; cell statistics</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/addStatistics.html">addStatistics</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>)
<span class="co">## visualize</span>
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/4_a_spatial_locations.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'nr_genes'</span>, <span class="kw">color_as_factor</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/4_b_nr_genes.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># add black background image</span>
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">"black_bg"</span>,
           <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'nr_genes'</span>, <span class="kw">color_as_factor</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/4_c_nr_genes_black_bg.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co">## alternative: directly provide a gimage (giotto image object), this will override the the image_name param</span>
<span class="fu"><a href="../reference/spatPlot.html">spatPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">gimage</span> <span class="kw">=</span> <span class="no">orig_charc_png</span>,
           <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'nr_genes'</span>, <span class="kw">color_as_factor</span> <span class="kw">=</span> <span class="no">F</span>, <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/4_d_nr_genes_charc_bg.png" style="width:50.0%"></p>
</div>
<div id="dimension-reduction" class="section level4">
<h4 class="hasAnchor">
<a href="#dimension-reduction" class="anchor"></a>5.2 dimension reduction</h4>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co">## highly variable genes (HVG)</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calculateHVG.html">calculateHVG</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">nr_expression_groups</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="co">## select genes based on HVG and gene statistics, both found in gene metadata</span>
<span class="no">gene_metadata</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fDataDT.html">fDataDT</a></span>(<span class="no">visium_kidney</span>)
<span class="no">featgenes</span> <span class="kw">=</span> <span class="no">gene_metadata</span>[<span class="no">hvg</span> <span class="kw">==</span> <span class="st">'yes'</span> <span class="kw">&amp;</span> <span class="no">perc_cells</span> <span class="kw">&gt;</span> <span class="fl">4</span> <span class="kw">&amp;</span> <span class="no">mean_expr_det</span> <span class="kw">&gt;</span> <span class="fl">0.5</span>]$<span class="no">gene_ID</span>

<span class="co">## run PCA on expression values (default)</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runPCA.html">runPCA</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">genes_to_use</span> <span class="kw">=</span> <span class="no">featgenes</span>)

<span class="co">## run UMAP and tSNE on PCA space (default)</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/runUMAP.html">runUMAP</a></span>(<span class="no">visium_kidney</span>, <span class="kw">dimensions_to_use</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">10</span>)
<span class="fu"><a href="../reference/plotUMAP.html">plotUMAP</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/5_c_UMAP_reduction.png" style="width:50.0%"></p>
</div>
<div id="cluster" class="section level4">
<h4 class="hasAnchor">
<a href="#cluster" class="anchor"></a>5.3 cluster</h4>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="co">## sNN network (default)</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/createNearestNetwork.html">createNearestNetwork</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">dimensions_to_use</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">10</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">15</span>)
<span class="co">## Leiden clustering</span>
<span class="no">visium_kidney</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/doLeidenCluster.html">doLeidenCluster</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">resolution</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">n_iterations</span> <span class="kw">=</span> <span class="fl">1000</span>)
<span class="fu"><a href="../reference/plotUMAP.html">plotUMAP</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>,
         <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'leiden_clus'</span>, <span class="kw">show_NN_network</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>)</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/6_a_UMAP_leiden.png" style="width:50.0%"></p>
</div>
<div id="co-visualize" class="section level4">
<h4 class="hasAnchor">
<a href="#co-visualize" class="anchor"></a>5.4 co-visualize</h4>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># expression and spatial</span>
<span class="fu"><a href="../reference/showGiottoImageNames.html">showGiottoImageNames</a></span>(<span class="no">visium_kidney</span>)

<span class="fu"><a href="../reference/spatDimPlot.html">spatDimPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'leiden_clus'</span>,
            <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'black_bg'</span>,
            <span class="kw">dim_point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">spat_point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'7_a_covis_leiden_black'</span>))</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/7_a_covis_leiden_black.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/spatDimPlot.html">spatDimPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'leiden_clus'</span>,
            <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image_neg'</span>,
            <span class="kw">dim_point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">spat_point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'7_b_covis_leiden_negated'</span>))</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/7_b_covis_leiden_negated.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="../reference/spatDimPlot.html">spatDimPlot</a></span>(<span class="kw">gobject</span> <span class="kw">=</span> <span class="no">visium_kidney</span>, <span class="kw">cell_color</span> <span class="kw">=</span> <span class="st">'leiden_clus'</span>,
            <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image_charc'</span>,
            <span class="kw">dim_point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">spat_point_size</span> <span class="kw">=</span> <span class="fl">2.5</span>,
            <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'7_b_covis_leiden_charc'</span>))</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/7_b_covis_leiden_charc.png" style="width:50.0%"></p>
</div>
<div id="spatial-gene-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#spatial-gene-plots" class="anchor"></a>5.5 spatial gene plots</h4>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co">## gene plots ##</span>
<span class="fu"><a href="../reference/spatGenePlot.html">spatGenePlot</a></span>(<span class="no">visium_kidney</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image_charc'</span>,
             <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Lrp2'</span>, <span class="st">'Sptssb'</span>, <span class="st">'Slc12a3'</span>),  <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">cell_color_gradient</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'darkblue'</span>, <span class="st">'white'</span>, <span class="st">'red'</span>), <span class="kw">gradient_midpoint</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'8_a_spatgene_charc'</span>))</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/8_a_spatgene_charc.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="../reference/spatGenePlot.html">spatGenePlot</a></span>(<span class="no">visium_kidney</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image_charc'</span>,
             <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">point_shape</span> <span class="kw">=</span> <span class="st">'voronoi'</span>,
             <span class="kw">genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Lrp2'</span>, <span class="st">'Sptssb'</span>, <span class="st">'Slc12a3'</span>),  <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">cell_color_gradient</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'darkblue'</span>, <span class="st">'white'</span>, <span class="st">'red'</span>), <span class="kw">gradient_midpoint</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">vor_alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'8_b_spatgene_charc_vor'</span>))</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/8_b_spatgene_charc_vor.png" style="width:50.0%"></p>
</div>
<div id="subset-plots" class="section level4">
<h4 class="hasAnchor">
<a href="#subset-plots" class="anchor"></a>5.6 subset plots</h4>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">visium_kidney_subset</span> <span class="kw">=</span> <span class="fu"><a href="../reference/subsetGiottoLocs.html">subsetGiottoLocs</a></span>(<span class="no">visium_kidney</span>, <span class="kw">x_min</span> <span class="kw">=</span> <span class="fl">3000</span>, <span class="kw">x_max</span> <span class="kw">=</span> <span class="fl">5500</span>, <span class="kw">y_min</span> <span class="kw">=</span> -<span class="fl">10000</span>, <span class="kw">y_max</span> <span class="kw">=</span> -<span class="fl">7000</span>)

<span class="fu"><a href="../reference/spatGenePlot.html">spatGenePlot</a></span>(<span class="no">visium_kidney_subset</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image_charc'</span>,
             <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">4</span>,
             <span class="kw">genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Lrp2'</span>, <span class="st">'Sptssb'</span>, <span class="st">'Slc12a3'</span>),  <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">cell_color_gradient</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'darkblue'</span>, <span class="st">'white'</span>, <span class="st">'red'</span>), <span class="kw">gradient_midpoint</span> <span class="kw">=</span> <span class="fl">0</span>,
             <span class="kw">point_alpha</span> <span class="kw">=</span> <span class="fl">0.8</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'9_a_subset_spatgene_charc'</span>))</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/9_a_subset_spatgene_charc.png" style="width:50.0%"></p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="../reference/spatGenePlot.html">spatGenePlot</a></span>(<span class="no">visium_kidney_subset</span>, <span class="kw">show_image</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">image_name</span> <span class="kw">=</span> <span class="st">'image_charc'</span>,
             <span class="kw">expression_values</span> <span class="kw">=</span> <span class="st">'scaled'</span>, <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">4</span>,  <span class="kw">point_shape</span> <span class="kw">=</span> <span class="st">'voronoi'</span>, <span class="kw">vor_alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>,
             <span class="kw">genes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Lrp2'</span>, <span class="st">'Sptssb'</span>, <span class="st">'Slc12a3'</span>),  <span class="kw">cow_n_col</span> <span class="kw">=</span> <span class="fl">2</span>,
             <span class="kw">cell_color_gradient</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'darkblue'</span>, <span class="st">'white'</span>, <span class="st">'red'</span>), <span class="kw">gradient_midpoint</span> <span class="kw">=</span> <span class="fl">0</span>,
             <span class="kw">save_param</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">save_name</span> <span class="kw">=</span> <span class="st">'9_b_subset_spatgene_charc_vor'</span>))</pre></body></html></div>
<p><img src="../inst/howtos/giotto_images/vignette_1/9_b_subset_spatgene_charc_vor.png" style="width:50.0%"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.rubendries.com/">Ruben Dries</a>, Huipeng Li, Qian Zhu, Rui Dong, Guo-Cheng Yuan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
